<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chia Wallet Store </title>
    <script src="qrcode.min.js"></script>

    <link rel="stylesheet" type="text/css" href="hourGlass.css">

    <style>
        @font-face {
            font-family: SourceSansPro;
            src: url(SourceSansPro-Regular.ttf);
        }

        body {
            font-size: 1.5em;
            background-color: #EEEEEE;
            font-family: SourceSansPro;

        }

        .container {
            display: flex;
            justify-content: center;
            padding: 0px;

        }

        #header {
            background: linear-gradient(300deg, green 0%, #0D3746 100%);
            color: #fafafa;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            margin-bottom: 50px;

        }

        .child {}

        .child.textMes {
            margin: 30px 10px;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            padding: 15px;
            background-color: white;

        }

        button {
            background: #3AAC59;
            color: white;
            border-radius: 2px;
            font-weight: bold;
            font-size: 18px;
            padding: 1em;
            margin: 10px;
            border: none;
            cursor: pointer;
        }

        .item1 {
            text-align: center;
        }

        .item1 div {
            margin: 20px 0;
        }

        .item2 {
            margin: 30px;
            display: flex;
            justify-content: center;
        }

        .options {
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            padding: 20px;
            background-color: white;
        }


        .overlay {
            position: fixed;
            display: none;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2;
            cursor: pointer;
        }

        .text {
            position: absolute;
            top: 25%;
            left: 25%;
            font-size: 150%;
            color: white;
            transform: translate(-25%, -25%);
            width: 100%;
            padding: 3%;

        }


        input#seed_phrase {
            /* display: block; */
            width: 90%;
            font-size: 80%;

        }

        #sendAndReceive {
            display: none;
            padding: 20px;

        }

        #qr_code {
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div id="header" class="container">
        <div class="child">
            <h3> Chia Wallet </h3>
        </div>
    </div>


    <div class="container" id="createAndRestore">
        <div class="child options">
            <div class="item1">
                You have two options.
            </div>

            <div class="item2">
                <button id="createWallet">Create Wallet</button>
                <button id="restoreWallet">Restore Wallet</button>
            </div>
        </div>
    </div>


    <div class="container" id="sendAndReceive">
        <div class="child options">
            <div class="item1">
                <div> Your XCH (Chia) balance is <span id="XCHBalance">
                        <div class="lds-roller">
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                            <div></div>
                        </div>
                    </span> </div>
                <div>Your XCH address is <span id="address"></span> </div>
                <div>The QR code to receive XCH is below</div>

                <div id="qr_code"></div>
            </div>


            <div class="item2">
                <button id="send">Send XCH (Coming Soon)</button>
            </div>
        </div>
    </div>



    <div id="overlayCreate" class="overlay">
        <div class="text">It takes around 30 to 60 seconds to create a Chia Wallet. Enjoy the silence till then. <div
                class="lds-hourglass"></div>
        </div>
    </div>

    <div id="overlayRestore" class="overlay">
        <div class="text">Type your seed phrase
            <input id="seed_phrase" type="text">
            <button id="submitRestore">Restore</button>
        </div>
    </div>

    <script>

        async function balance() {

            try {
                const keyGenAPI = await fetch("https://api.chiawallet.store:32253/balanceN?fingerprintNo=" + localStorage.getItem("fingerprintNo"));
                const keyGenJSON = await keyGenAPI.json()
                document.querySelector("#XCHBalance").innerText = keyGenJSON.balance
            }
            catch {
                alert("Some Error in fetching balance. Contact admin@chiawallet.store and blame him")
            }
        }

        function changeScreens() {

            document.querySelector("#createAndRestore").remove()

            document.querySelector("#overlayCreate").style.display = "none";
            document.querySelector("#sendAndReceive").style.display = "block";
            new QRCode(document.getElementById("qr_code"), localStorage.getItem("XCH_address"));

            document.querySelector("#address").innerText = localStorage.getItem("XCH_address")

            balance()
        }


        document.querySelector("#createWallet").addEventListener("click", createWalletFn);
        async function createWalletFn() {
            try {
                document.getElementById("overlayCreate").style.display = "block";

                const keyGenAPI = await fetch("https://api.chiawallet.store:32253/keyGen");
                const keyGenJSON = await keyGenAPI.json()
                localStorage.setItem('seed_phrase', keyGenJSON.seed_phrase);
                localStorage.setItem('fingerprintNo', keyGenJSON.fingerprintNo);
                localStorage.setItem('XCH_address', keyGenJSON.XCH_address);
                changeScreens();
            }
            catch {
                alert("Some Error. Contact admin@chiawallet.store and blame him")
            }
        }



        document.querySelector("#restoreWallet").addEventListener("click", restoreWalletFnS);
        document.querySelector("#submitRestore").addEventListener("click", restoreWalletFn);

        function restoreWalletFnS() {
            document.getElementById("overlayRestore").style.display = "block";
        }

        async function restoreWalletFn() {
            try {

                const keyGenAPI = await fetch("https://api.chiawallet.store:32253/restore?seed_phrase=" + document.querySelector("#seed_phrase"));
                const keyGenJSON = await keyGenAPI.json()
                localStorage.setItem('fingerprintNo', keyGenJSON.fingerprintNo);
                localStorage.setItem('XCH_address', keyGenJSON.XCH_address);
                changeScreens();
            }
            catch {
                alert("Some Error. Contact admin@chiawallet.store and blame him")
            }
        }
    </script>
    <script>
        if (localStorage.getItem("XCH_address") !== null) {
            changeScreens();
        }


    </script>


</body>

</html>